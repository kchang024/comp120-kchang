var map;var myLat=0;var myLng=0;function initMap(){var a=new google.maps.LatLng(myLat,myLng);map=new google.maps.Map(document.getElementById("map"),{center:a,zoom:13});getLocation()}function getLocation(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){myLat=a.coords.latitude;myLng=a.coords.longitude;makeMap();hailRides()})}else{alert("Geolocation not supported by this browser!")}}function makeMap(){myLocation=new google.maps.LatLng(myLat,myLng);map.panTo(myLocation)}function hailRides(){var a=new XMLHttpRequest();a.open("POST","https://jordan-marsh.herokuapp.com/rides",true);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(a.readyState==4&&a.status==200){var d=a.responseText;var o=JSON.parse(d);var b=new google.maps.LatLngBounds();var n=1000000.11;var e=new google.maps.InfoWindow();for(var j=0;j<o.length;j++){rideLat=o[j]["lat"];rideLng=o[j]["lng"];rideLocation=new google.maps.LatLng(rideLat,rideLng);var k=new google.maps.Marker({position:rideLocation,icon:"car.png",map:map,title:"notUber car"});distBetw=google.maps.geometry.spherical.computeDistanceBetween(myLocation,rideLocation);distBetwMiles=toMiles(distBetw);makeInfoWindow(k,map,e,"This car is "+distBetwMiles+" miles away from you");if(distBetwMiles<n){n=distBetwMiles;var m=o[j]["username"];var h=rideLat;var l=rideLng}b.extend(rideLocation)}map.fitBounds(b);var c=new google.maps.Marker({position:myLocation,map:map,title:"Hi Ming! Based on Google's Geolocation, this is where YOU are!"});var f=new google.maps.InfoWindow();var g='<h1>Where is my notUber?</h1><div id="bodyContent"><p>Closest car is: '+m+"</p><p>Currently at: "+h+", "+l+"</p><p>"+m+" is "+n+" miles away</p>";"</div>";makeInfoWindow(c,map,f,g);drawPolyline(myLat,myLng,h,l)}else{if(a.readyState==4&&a.status!=200){document.getElementById("map").innerHTML=request.status+"<p> ERROR </p>"}}};a.send("username=RgSVguNn&lat="+myLat+"&lng="+myLng)}function drawPolyline(c,a,e,b){var d=new google.maps.Polyline({path:[{lat:c,lng:a},{lat:e,lng:b}],geodesic:true,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});d.setMap(map)}function toMiles(a){return a*0.000621371}function makeInfoWindow(a,d,b,c){a.addListener("click",function(){b.setContent(c);b.open(d,this)},{passive:true})};